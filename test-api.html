<!DOCTYPE html>
<html>
<head>
    <title>API Test</title>
    <meta charset="UTF-8">
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        button { margin: 5px; padding: 8px 16px; }
        pre { background: #f5f5f5; padding: 10px; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>Тестирование API</h1>
    
    <h2>1. Проверка уникальности ID</h2>
    <button onclick="testDuplicateID()">Добавить дубликат ID=1</button>
    <pre id="duplicate-result">Результат будет здесь...</pre>
    
    <h2>2. Проверка кодировки UTF-8</h2>
    <button onclick="testUTF8()">Добавить запись с русским текстом</button>
    <button onclick="getAllStocks()">Получить все записи</button>
    <pre id="utf8-result">Результат будет здесь...</pre>
    
    <h2>3. Проверка метода PATCH</h2>
    <button onclick="testPatch()">Обновить запись ID=1</button>
    <button onclick="getStock(1)">Получить запись ID=1</button>
    <pre id="patch-result">Результат будет здесь...</pre>
    
    <script>
        const API_URL = 'http://localhost:8000/stocks';
        
        async function testDuplicateID() {
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        id: 1,
                        src: "https://example.com/test.jpg",
                        title: "Тест",
                        text: "Проверка дубликата"
                    })
                });
                const data = await response.text();
                document.getElementById('duplicate-result').textContent = data;
            } catch (error) {
                document.getElementById('duplicate-result').textContent = error.toString();
            }
        }
        
        async function testUTF8() {
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        id: Math.floor(Math.random() * 1000) + 100, // Случайный ID
                        src: "https://example.com/test.jpg",
                        title: "Проверка кодировки",
                        text: "Русский текст работает корректно"
                    })
                });
                const data = await response.json();
                document.getElementById('utf8-result').textContent = JSON.stringify(data, null, 2);
            } catch (error) {
                document.getElementById('utf8-result').textContent = error.toString();
            }
        }
        
        async function getAllStocks() {
            try {
                const response = await fetch(API_URL);
                const data = await response.json();
                document.getElementById('utf8-result').textContent = JSON.stringify(data, null, 2);
            } catch (error) {
                document.getElementById('utf8-result').textContent = error.toString();
            }
        }
        
        async function testPatch() {
            try {
                const response = await fetch(`${API_URL}/1`, {
                    method: 'PATCH',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        title: "Обновленный заголовок",
                        text: "Обновленный текст"
                    })
                });
                const data = await response.json();
                document.getElementById('patch-result').textContent = JSON.stringify(data, null, 2);
            } catch (error) {
                document.getElementById('patch-result').textContent = error.toString();
            }
        }
        
        async function getStock(id) {
            try {
                const response = await fetch(`${API_URL}/${id}`);
                const data = await response.json();
                document.getElementById('patch-result').textContent = JSON.stringify(data, null, 2);
            } catch (error) {
                document.getElementById('patch-result').textContent = error.toString();
            }
        }
    </script>
</body>
</html>
